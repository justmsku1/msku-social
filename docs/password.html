<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Şifremi Unuttum - Just MSKU</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    
    <style>
        /* --- TASARIM (Giriş sayfasıyla aynı stil) --- */
        *{ margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
        body{ 
            background: #000; 
            color: #fff; 
            display: flex; 
            flex-direction: column;
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
        }

        h1 { color: #24caac; margin-bottom: 10px; }
        p { color: #ccc; margin-bottom: 30px; }

        .container{ 
            background: #1a1a1a; 
            width: 380px; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0px 0px 15px rgba(255,255,255,0.1); 
            text-align: center; 
        }

        .title { font-size: 24px; font-weight: 600; margin-bottom: 10px; color: #24caac; }
        .subtitle { font-size: 13px; color: #aaa; margin-bottom: 20px; line-height: 1.5; }

        .input-box{ width: 100%; margin-bottom: 15px; }
        .input-box input{ width: 100%; padding: 12px; border-radius: 6px; border: none; background: #333; color: #fff; outline: none; }

        .button input{ 
            width: 100%; background: #24caac; color: #000; font-weight: bold; 
            cursor: pointer; transition: 0.3s; padding: 12px; border: none; border-radius: 6px; margin-top: 10px;
        }
        .button input:hover{ opacity: 0.8; }

        .back-link { margin-top: 20px; font-size: 14px; }
        .back-link a { color: #24caac; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px;}
        .back-link a:hover { text-decoration: underline; }

        /* Mesaj Kutuları */
        .message-box {
            font-size: 13px; margin-bottom: 15px; display: none; padding: 10px; border-radius: 5px;
        }
        .error-msg { color: #ff4b4b; background: rgba(255, 75, 75, 0.1); border: 1px solid #ff4b4b; }
        .success-msg { color: #24caac; background: rgba(36, 202, 172, 0.1); border: 1px solid #24caac; }
    </style>
</head>
<body>

    <h1>Just MSKU</h1>
    
    <div class="container">
        <form id="resetForm">
            <div class="title">Şifre Sıfırlama</div>
            <div class="subtitle">
                Lütfen <strong>@posta.mu.edu.tr</strong> uzantılı okul e-posta adresinizi girin. Size bir sıfırlama bağlantısı göndereceğiz.
            </div>

            <div class="input-box">
                <input type="email" id="resetEmail" placeholder="ogrenci@posta.mu.edu.tr" required>
            </div>

            <div id="statusMessage" class="message-box"></div>

            <div class="input-box button">
                <input type="submit" value="Bağlantı Gönder">
            </div>
        </form>

        <div class="back-link">
            <a href="login.html"><i class="fa-solid fa-arrow-left"></i> Giriş Sayfasına Dön</a>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Firebase Config (Giriş sayfasındakiyle AYNISI olmalı)
        const firebaseConfig = {
            apiKey: "AIzaSyDLRlyPJvO5tPtnuzNAtO6H0_t7mo_3qoU",
            authDomain: "justmsku.firebaseapp.com",
            projectId: "justmsku",
            storageBucket: "justmsku.firebasestorage.app",
            messagingSenderId: "424626283802",
            appId: "1:424626283802:web:83502f1c09cdcf9acd78a3"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        const resetForm = document.getElementById('resetForm');
        const statusDiv = document.getElementById('statusMessage');

        resetForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('resetEmail').value.trim().toLowerCase();

            // Mesaj kutusunu temizle ve gizle
            statusDiv.style.display = 'none';
            statusDiv.className = 'message-box';

            // 1. KONTROL: @posta.mu.edu.tr uzantısı var mı?
            if (!email.endsWith("@posta.mu.edu.tr")) {
                showStatus("Lütfen geçerli bir MSKU öğrenci e-postası (@posta.mu.edu.tr) giriniz.", "error");
                return;
            }

            try {
                // Firebase Şifre Sıfırlama Fonksiyonu
                await sendPasswordResetEmail(auth, email);
                
                showStatus("Sıfırlama bağlantısı e-posta adresinize gönderildi! Lütfen gelen kutunuzu (ve spam klasörünü) kontrol edin.", "success");
                
                // Formu temizle
                document.getElementById('resetEmail').value = "";

            } catch (error) {
                console.error("Hata:", error);
                if (error.code === 'auth/user-not-found') {
                    showStatus("Bu e-posta adresiyle kayıtlı bir kullanıcı bulunamadı.", "error");
                } else if (error.code === 'auth/invalid-email') {
                    showStatus("Geçersiz e-posta formatı.", "error");
                } else {
                    showStatus("Bir hata oluştu: " + error.message, "error");
                }
            }
        });

        function showStatus(msg, type) {
            statusDiv.textContent = msg;
            statusDiv.classList.add(type === "success" ? "success-msg" : "error-msg");
            statusDiv.style.display = 'block';
        }
    </script>
</body>
</html>